apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.14.0
  labels:
    app.kubernetes.io/name: kubeblocks
  name: reconciliationplans.view.kubeblocks.io
spec:
  group: view.kubeblocks.io
  names:
    kind: ReconciliationPlan
    listKind: ReconciliationPlanList
    plural: reconciliationplans
    singular: reconciliationplan
  scope: Namespaced
  versions:
  - name: v1
    schema:
      openAPIV3Schema:
        description: ReconciliationPlan is the Schema for the reconciliationplans
          API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: ReconciliationPlanSpec defines the desired state of ReconciliationPlan
            properties:
              depth:
                default: 1
                description: |-
                  Depth of the object tree.
                  Default is 1, means the top primary object only.
                format: int32
                minimum: 1
                type: integer
              desiredSpec:
                description: |-
                  DesiredSpec specifies desired spec of the Cluster object.
                  The desired spec will be merged into the current spec in the same way as `kubectl apply` to build the final spec,
                  and the reconciliation plan will be calculated by comparing the current spec to the final spec.
                  DesiredSpec should be a valid YAML string.
                type: string
              locale:
                description: Locale specifies the locale to use when localizing the
                  reconciliation plan.
                type: string
              stateEvaluationExpression:
                description: StateEvaluationExpression overrides the value specified
                  in ReconciliationViewDefinition.
                properties:
                  celExpression:
                    description: |-
                      CELExpression specifies to use CEL to evaluation the object state.
                      The root object used in the expression is the primary object.
                    properties:
                      expression:
                        description: Expression specifies the CEL expression.
                        type: string
                    required:
                    - expression
                    type: object
                type: object
              targetObject:
                description: |-
                  TargetObject specifies the target Cluster object.
                  Default is the Cluster object with same namespace and name as this ReconciliationPlan object.
                properties:
                  name:
                    description: |-
                      Name of the referent.
                      Default is same as the ReconciliationPlan object.
                    type: string
                  namespace:
                    description: |-
                      Namespace of the referent.
                      Default is same as the ReconciliationPlan object.
                    type: string
                type: object
              viewDefinition:
                description: ViewDefinition specifies the name of the ReconciliationViewDefinition.
                type: string
            required:
            - desiredSpec
            - viewDefinition
            type: object
          status:
            description: ReconciliationPlanStatus defines the observed state of ReconciliationPlan
            properties:
              currentObjectTree:
                description: CurrentObjectTree specifies the current object tree.
                properties:
                  primary:
                    description: Primary specifies reference of the primary object.
                    properties:
                      apiVersion:
                        description: API version of the referent.
                        type: string
                      fieldPath:
                        description: |-
                          If referring to a piece of an object instead of an entire object, this string
                          should contain a valid JSON/Go field access statement, such as desiredState.manifest.containers[2].
                          For example, if the object reference is to a container within a pod, this would take on a value like:
                          "spec.containers{name}" (where "name" refers to the name of the container that triggered
                          the event) or if no container name is specified "spec.containers[2]" (container with
                          index 2 in this pod). This syntax is chosen only to have some well-defined way of
                          referencing a part of an object.
                          TODO: this design is not final and this field is subject to change in the future.
                        type: string
                      kind:
                        description: |-
                          Kind of the referent.
                          More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
                        type: string
                      name:
                        description: |-
                          Name of the referent.
                          More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                        type: string
                      namespace:
                        description: |-
                          Namespace of the referent.
                          More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/
                        type: string
                      resourceVersion:
                        description: |-
                          Specific resourceVersion to which this reference is made, if any.
                          More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#concurrency-control-and-consistency
                        type: string
                      uid:
                        description: |-
                          UID of the referent.
                          More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#uids
                        type: string
                    type: object
                    x-kubernetes-map-type: atomic
                  secondaries:
                    description: |-
                      Secondaries describes all the secondary objects of this object, if any.
                      The secondary objects are collected by the rules specified in ReconciliationViewDefinition.
                    x-kubernetes-preserve-unknown-fields: true
                required:
                - primary
                type: object
              desiredObjectTree:
                description: DesiredObjectTree specifies the object tree if the spec.desiredSpec
                  is applied.
                properties:
                  primary:
                    description: Primary specifies reference of the primary object.
                    properties:
                      apiVersion:
                        description: API version of the referent.
                        type: string
                      fieldPath:
                        description: |-
                          If referring to a piece of an object instead of an entire object, this string
                          should contain a valid JSON/Go field access statement, such as desiredState.manifest.containers[2].
                          For example, if the object reference is to a container within a pod, this would take on a value like:
                          "spec.containers{name}" (where "name" refers to the name of the container that triggered
                          the event) or if no container name is specified "spec.containers[2]" (container with
                          index 2 in this pod). This syntax is chosen only to have some well-defined way of
                          referencing a part of an object.
                          TODO: this design is not final and this field is subject to change in the future.
                        type: string
                      kind:
                        description: |-
                          Kind of the referent.
                          More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
                        type: string
                      name:
                        description: |-
                          Name of the referent.
                          More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                        type: string
                      namespace:
                        description: |-
                          Namespace of the referent.
                          More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/
                        type: string
                      resourceVersion:
                        description: |-
                          Specific resourceVersion to which this reference is made, if any.
                          More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#concurrency-control-and-consistency
                        type: string
                      uid:
                        description: |-
                          UID of the referent.
                          More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#uids
                        type: string
                    type: object
                    x-kubernetes-map-type: atomic
                  secondaries:
                    description: |-
                      Secondaries describes all the secondary objects of this object, if any.
                      The secondary objects are collected by the rules specified in ReconciliationViewDefinition.
                    x-kubernetes-preserve-unknown-fields: true
                required:
                - primary
                type: object
              observedPlanGeneration:
                description: ObservedPlanGeneration specifies the observed generation
                  of the ReconciliationPlan object.
                format: int64
                type: integer
              observedTargetGeneration:
                description: ObservedTargetGeneration specifies the observed generation
                  of the target object.
                format: int64
                type: integer
              phase:
                description: |-
                  Phase specifies the current phase of the plan calculation process.
                  Succeed - the plan is calculated successfully.
                  Failed - the plan can't be calculated for some reason described in Reason.
                enum:
                - Succeed
                - Failed
                type: string
              plan:
                description: Plan describes the detail reconciliation process if the
                  DesiredSpec specified in ReconciliationPlanSpec is applied.
                items:
                  description: ObjectChange defines a detailed change of an object.
                  properties:
                    LocalDescription:
                      description: |-
                        LocalDescription is the localized version of Description by using the Locale specified in `spec.locale`.
                        Empty if the `spec.locale` is not specified.
                      type: string
                    changeType:
                      description: |-
                        ChangeType specifies the change type.
                        Event - specifies that this is a Kubernetes Event.
                        ObjectCreation - specifies that this is an object creation.
                        ObjectUpdate - specifies that this is an object update.
                        ObjectDeletion - specifies that this is an object deletion.
                      enum:
                      - Event
                      - ObjectCreation
                      - ObjectUpdate
                      - ObjectDeletion
                      type: string
                    description:
                      description: Description describes the change in a user-friendly
                        way.
                      type: string
                    eventAttributes:
                      description: EventAttributes specifies the attributes of the
                        event when ChangeType is Event.
                      properties:
                        reason:
                          description: Reason of the Event.
                          type: string
                        type:
                          description: Type of the Event.
                          type: string
                      required:
                      - reason
                      - type
                      type: object
                    objectReference:
                      description: ObjectReference specifies the Object this change
                        described.
                      properties:
                        apiVersion:
                          description: API version of the referent.
                          type: string
                        fieldPath:
                          description: |-
                            If referring to a piece of an object instead of an entire object, this string
                            should contain a valid JSON/Go field access statement, such as desiredState.manifest.containers[2].
                            For example, if the object reference is to a container within a pod, this would take on a value like:
                            "spec.containers{name}" (where "name" refers to the name of the container that triggered
                            the event) or if no container name is specified "spec.containers[2]" (container with
                            index 2 in this pod). This syntax is chosen only to have some well-defined way of
                            referencing a part of an object.
                            TODO: this design is not final and this field is subject to change in the future.
                          type: string
                        kind:
                          description: |-
                            Kind of the referent.
                            More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
                          type: string
                        name:
                          description: |-
                            Name of the referent.
                            More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                          type: string
                        namespace:
                          description: |-
                            Namespace of the referent.
                            More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/
                          type: string
                        resourceVersion:
                          description: |-
                            Specific resourceVersion to which this reference is made, if any.
                            More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#concurrency-control-and-consistency
                          type: string
                        uid:
                          description: |-
                            UID of the referent.
                            More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#uids
                          type: string
                      type: object
                      x-kubernetes-map-type: atomic
                    revision:
                      description: |-
                        Revision specifies the revision of the object after this change.
                        Revision can be compared globally between all ObjectChanges of all Objects, to build a total order object change sequence.
                      format: int64
                      type: integer
                    state:
                      description: State represents the state calculated by StateEvaluationExpression
                        defines in ReconciliationViewDefinition when this change occurs.
                      type: string
                    timestamp:
                      description: |-
                        Timestamp is a timestamp representing the ReconciliationPlan Controller time when this change occurred.
                        It is not guaranteed to be set in happens-before order across separate changes.
                        It is represented in RFC3339 form and is in UTC.
                        It is set to empty when used in ObjectReconciliationPlan.
                      format: date-time
                      type: string
                  required:
                  - changeType
                  - description
                  - objectReference
                  - revision
                  type: object
                type: array
              reason:
                description: Reason specifies the detail reason when the Phase is
                  Failed.
                type: string
              summary:
                description: Summary summarizes the final state to give an overview
                  of what will happen if the reconciliation plan is executed.
                properties:
                  objectSummaries:
                    description: ObjectSummaries summarizes each object type.
                    items:
                      description: ObjectSummary defines the total and change of an
                        object.
                      properties:
                        changeSummary:
                          description: |-
                            ChangeSummary summarizes the change by comparing the final state to the current state of this type.
                            Nil means no change.
                          properties:
                            added:
                              description: Added specifies the number of object will
                                be added.
                              format: int32
                              type: integer
                            deleted:
                              description: Deleted specifies the number of object
                                will be deleted.
                              format: int32
                              type: integer
                            updated:
                              description: Updated specifies the number of object
                                will be updated.
                              format: int32
                              type: integer
                          type: object
                        total:
                          description: Total number of the object of type defined
                            by Type.
                          format: int32
                          type: integer
                        type:
                          description: Type of the object.
                          properties:
                            apiVersion:
                              description: APIVersion of the type.
                              type: string
                            kind:
                              description: Kind of the type.
                              type: string
                          required:
                          - apiVersion
                          - kind
                          type: object
                      required:
                      - total
                      - type
                      type: object
                    type: array
                  specChange:
                    description: "SpecChange describes the change between the current
                      spec and the final spec.\nThe whole spec struct will be compared
                      and an example SpecChange looks like:\n{\n\t\tAffinity: {\n
                      \  \t\tPodAntiAffinity: \"Preferred\",\n   \t\tTenancy: \"SharedNode\",\n\t\t},\n
                      \tComponentSpecs: {\n\t\t\t{\n \t\t\tComponentDef: \"postgresql\",\n
                      \  \t\t\tName: \"postgresql\",\n-    \t\tReplicas: 2,\n   \t\t\tResources:\n\t\t\t\t{\n
                      \    \t\t\tLimits:\n\t\t\t\t\t{\n-        \t\t\tCPU: 500m,\n-
                      \      \t\t\t\tMemory: 512Mi,\n\t\t\t\t\t},\n     \t\t\tRequests:\n\t\t\t\t\t{\n-
                      \     \t\t\t\tCPU: 500m,\n-      \t\t\t\tMemory: 512Mi,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n}"
                    type: string
                required:
                - objectSummaries
                - specChange
                type: object
            required:
            - currentObjectTree
            - desiredObjectTree
            - observedPlanGeneration
            - observedTargetGeneration
            - plan
            - summary
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
